from CybORG import CybORG
import inspect

from CybORG.Agents.SimpleAgents.KeyboardAgent import KeyboardAgent
from CybORG.Agents.SimpleAgents.EnterpriseGreenAgent import EnterpriseGreenAgent
from CybORG.Agents.Wrappers.BlueEnterpriseWrapper import BlueEnterpriseWrapper
from CybORG.Agents import RandomAgent,RandomSelectRedAgent

if __name__ == "__main__":
    print("Setup")
    path = str(inspect.getfile(CybORG))
    path = path[:-7] + f'/Shared/Scenarios/Scenario1b.yaml'

    agents = {'Red': RandomSelectRedAgent,'Green': EnterpriseGreenAgent}
    # agents = {'Red': RedMeanderAgent,'Green': GreenAgent}
    cyborg = BlueEnterpriseWrapper(CybORG(path, 'sim',agents=agents), output_mode='table').obs
    
    agent_name = 'Blue'

    results = cyborg.reset(agent=agent_name)
    observation = results.observation
    action_space = results.action_space

    agent = KeyboardAgent()

    reward = 0
    done = False
    hostname='blu_agent_0'
    while True:
        action = agent.get_action(observation, action_space)
        results = cyborg.step(agent=hostname, action=action)
        print(cyborg.get_last_action(agent='Red'))
        print('>>> Reward: ', results.reward)

        reward += results.reward
        observation = results.observation
        action_space = results.action_space
        if done:
            print(f"Game Over. Total reward: {reward}")
            break
