from CybORG.Shared import Observation
from CybORG.Simulator.Actions import Action
from CybORG.Simulator.Actions.ConcreteActions.StopService import StopService
from CybORG.Simulator.State import State
from CybORG.Simulator.File import File
import random


class CheckCredFile(Action):
    def __init__(self, hostname: str,filename:str,step_lag:int,password=0):
        super().__init__()
        self.hostname = hostname
        self.duration = 1
        self.filename=filename
        self.file=None
        self.step_lag=step_lag
        self.pswd = password

    def execute(self, state: State) -> Observation:
        host = state.hosts[self.hostname]
        for file in host.files:
            if file.name==self.filename:
                self.file=file
                break
        if self.pswd==self.file.message['password']:
            return Observation(success=True)
        else:
            return Observation(success=False)

    def __str__(self):
        return f"{self.__class__.__name__} {self.hostname}"

    def __eq__(self, other):
        if not isinstance(other, self.__class__):
            return False
        return all((
            self.name == other.name,
            self.hostname == other.hostname,
            self.agent == other.agent,
            self.session == other.session,
        ))
